<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานระบบจองโต๊ะงานสถาปนาแผนกช่างไฟฟ้ากำลัง</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #f8f9fa;
        }
        
        .report-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
        }
        
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-booked {
            background: #d4edda;
            color: #155724;
        }
        
        .print-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .edit-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
        }
        
        .modal-password {
            max-width: 400px;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white;
                font-size: 12pt;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <!-- Modal สำหรับยืนยันรหัสผ่าน -->
    <div class="modal fade" id="passwordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-password">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">ยืนยันรหัสผ่านแอดมิน</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label">รหัสผ่านแอดมิน:</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="กรอกรหัสผ่าน">
                    </div>
                    <div class="alert alert-danger d-none" id="passwordError">
                        รหัสผ่านไม่ถูกต้อง!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                    <button type="button" class="btn btn-warning" onclick="verifyPassword()">ยืนยัน</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal สำหรับแก้ไขข้อมูล -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editModalTitle">แก้ไขข้อมูลการจอง</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editBookingId">
                        <div class="mb-3">
                            <label class="form-label">หมายเลขโต๊ะ:</label>
                            <input type="text" class="form-control" id="editTableNumber" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ชื่อผู้จอง:</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">เบอร์โทรศัพท์:</label>
                            <input type="tel" class="form-control" id="editUserPhone" required maxlength="10" pattern="0[0-9]{9}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">สถานะ:</label>
                            <select class="form-select" id="editStatus" required>
                                <option value="pending">รอชำระเงิน</option>
                                <option value="booked">จองแล้ว</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ราคา:</label>
                            <input type="number" class="form-control" id="editPrice" required min="0" step="100">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                    <button type="button" class="btn btn-danger" onclick="deleteBooking()">ลบข้อมูล</button>
                    <button type="button" class="btn btn-primary" onclick="saveChanges()">บันทึกการเปลี่ยนแปลง</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- ส่วนหัวรายงาน -->
        <div class="report-header text-center">
            <h1 class="display-5 mb-3">
                <i class="bi bi-clipboard-data"></i> รายงานระบบจองโต๊ะงานสถาปนาแผนกช่างไฟฟ้ากำลัง
            </h1>
            <p class="lead mb-0">ครบรอบ 50 ปี</p>
            <p class="small">อัปเดตล่าสุด: <span id="currentDate"></span></p>
        </div>

        <div class="container">
            <!-- สถิติสรุป -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h3 class="card-title mb-0">
                                <i class="bi bi-speedometer2"></i> สถิติสรุป
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="row" id="summaryStats">
                                <!-- สถิติจะถูกโหลดโดย JavaScript -->
                                <div class="col text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- รายการจองทั้งหมด -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow">
                        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                            <h3 class="card-title mb-0">
                                <i class="bi bi-list-check"></i> รายการจองทั้งหมด
                            </h3>
                            <button class="btn btn-light btn-sm no-print" onclick="refreshData()">
                                <i class="bi bi-arrow-clockwise"></i> รีเฟรช
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="allBookingsTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>โต๊ะ</th>
                                            <th>ชื่อผู้จอง</th>
                                            <th>เบอร์โทร</th>
                                            <th>สถานะ</th>
                                            <th>วันที่จอง</th>
                                            <th>ราคา</th>
                                            <th class="no-print">จัดการ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- ข้อมูลจะถูกโหลดโดย JavaScript -->
                                        <tr>
                                            <td colspan="8" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- สรุปตามสถานะ -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header bg-warning text-dark">
                            <h3 class="card-title mb-0">
                                <i class="bi bi-clock-history"></i> รอชำระเงิน
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="pendingBookings">
                                <!-- ข้อมูลจะถูกโหลดโดย JavaScript -->
                                <div class="text-center">
                                    <div class="spinner-border text-warning" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header bg-info text-white">
                            <h3 class="card-title mb-0">
                                <i class="bi bi-check-circle"></i> จองแล้ว
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="confirmedBookings">
                                <!-- ข้อมูลจะถูกโหลดโดย JavaScript -->
                                <div class="text-center">
                                    <div class="spinner-border text-info" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ปุ่มพิมพ์รายงาน -->
    <button class="btn btn-primary print-btn no-print" onclick="window.print()">
        <i class="bi bi-printer"></i> พิมพ์รายงาน
    </button>

    <!-- ปุ่มเปิดโหมดแก้ไข -->
    <button class="btn btn-warning edit-btn no-print" id="editModeBtn" onclick="toggleEditMode()">
        <i class="bi bi-pencil-square"></i> โหมดแก้ไข
    </button>

    <!-- Firebase -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyClVpWMGilotCNQIkovw4IbVcwsWRxb7Oo",
            authDomain: "sbtcparty68.firebaseapp.com",
            projectId: "sbtcparty68",
            storageBucket: "sbtcparty68.appspot.com",
            messagingSenderId: "106377620312",
            appId: "1:106377620312:web:2b703a7379b31989bed32d"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ตัวแปร global
        let tablePrice = 1000; // ราคาต่อโต๊ะ
        let totalTables = 112; // จำนวนโต๊ะทั้งหมด
        let editMode = false;
        const ADMIN_PASSWORD = "@sbtcadmin1234";

        // โหลดข้อมูลเมื่อหน้าเว็บโหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            // แสดงวันที่ปัจจุบัน
            updateCurrentDate();
            
            // โหลดข้อมูลทั้งหมด
            loadAllData();
        });

        // อัปเดตวันที่ปัจจุบัน
        function updateCurrentDate() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // โหลดข้อมูลทั้งหมด
        function loadAllData() {
            loadSummaryStats();
            loadAllBookings();
            loadBookingsByStatus();
        }

        // รีเฟรชข้อมูล
        function refreshData() {
            updateCurrentDate();
            loadAllData();
        }

        // โหลดสถิติสรุป
        async function loadSummaryStats() {
            try {
                const [tablesSnapshot, usersSnapshot] = await Promise.all([
                    db.collection('tables').get(),
                    db.collection('users').get()
                ]);
                
                let availableTables = totalTables;
                let pendingTables = 0;
                let bookedTables = 0;
                let totalRevenue = 0;
                
                tablesSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.status === 'pending') {
                        pendingTables++;
                        availableTables--;
                    } else if (data.status === 'booked') {
                        bookedTables++;
                        availableTables--;
                        totalRevenue += data.price || tablePrice;
                    }
                });
                
                const statsHtml = `
                    <div class="col-md-3 col-6 mb-3">
                        <div class="p-3 border rounded bg-light">
                            <div class="h2 text-primary">${availableTables}</div>
                            <div class="text-muted">โต๊ะว่าง</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="p-3 border rounded bg-light">
                            <div class="h2 text-warning">${pendingTables}</div>
                            <div class="text-muted">รอชำระเงิน</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="p-3 border rounded bg-light">
                            <div class="h2 text-success">${bookedTables}</div>
                            <div class="text-muted">จองแล้ว</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="p-3 border rounded bg-light">
                            <div class="h2 text-info">${usersSnapshot.size}</div>
                            <div class="text-muted">สมาชิก</div>
                        </div>
                    </div>
                    <div class="col-12 mt-3">
                        <div class="p-3 border rounded bg-light">
                            <div class="h3 text-dark">รายได้รวม: <span class="text-success">${totalRevenue.toLocaleString()} บาท</span></div>
                        </div>
                    </div>
                `;
                
                document.getElementById('summaryStats').innerHTML = statsHtml;
            } catch (error) {
                console.error('Error loading summary stats:', error);
                document.getElementById('summaryStats').innerHTML = `
                    <div class="col-12 text-center text-danger">
                        <i class="bi bi-exclamation-triangle"></i> เกิดข้อผิดพลาดในการโหลดข้อมูล
                    </div>
                `;
            }
        }

        // โหลดรายการจองทั้งหมด
        async function loadAllBookings() {
            try {
                const snapshot = await db.collection('tables')
                    .orderBy('bookedAt', 'desc')
                    .get();
                
                const tbody = document.querySelector('#allBookingsTable tbody');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center text-muted">ไม่มีข้อมูลการจอง</td>
                        </tr>
                    `;
                    return;
                }
                
                let counter = 1;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    
                    // จัดรูปแบบวันที่
                    const bookedDate = data.bookedAt ? 
                        data.bookedAt.toDate().toLocaleDateString('th-TH', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : 'ไม่ทราบวันที่';
                    
                    // สร้างแถวตาราง
                    row.innerHTML = `
                        <td>${counter++}</td>
                        <td>${data.tableLabel || getTableLabel(data.tableNumber)}</td>
                        <td>${data.userName || 'ไม่ทราบชื่อ'}</td>
                        <td>${data.userPhone || 'ไม่ทราบเบอร์'}</td>
                        <td>
                            <span class="status-badge ${data.status === 'pending' ? 'status-pending' : 'status-booked'}">
                                ${data.status === 'pending' ? 'รอชำระเงิน' : 'จองแล้ว'}
                            </span>
                        </td>
                        <td>${bookedDate}</td>
                        <td>${(data.price || tablePrice).toLocaleString()} บาท</td>
                        <td class="no-print">
                            <button class="btn btn-sm btn-outline-primary" onclick="editBooking('${doc.id}')" ${!editMode ? 'disabled' : ''}>
                                <i class="bi bi-pencil"></i> แก้ไข
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading all bookings:', error);
                document.querySelector('#allBookingsTable tbody').innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-danger">
                            <i class="bi bi-exclamation-triangle"></i> เกิดข้อผิดพลาดในการโหลดข้อมูล
                        </td>
                    </tr>
                `;
            }
        }

        // โหลดรายการจองแยกตามสถานะ
        async function loadBookingsByStatus() {
            try {
                const [pendingSnapshot, bookedSnapshot] = await Promise.all([
                    db.collection('tables').where('status', '==', 'pending').get(),
                    db.collection('tables').where('status', '==', 'booked').get()
                ]);
                
                // รายการรอชำระเงิน
                const pendingDiv = document.getElementById('pendingBookings');
                pendingDiv.innerHTML = '';
                
                if (pendingSnapshot.empty) {
                    pendingDiv.innerHTML = `
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle"></i> ไม่มีรายการจองที่รอชำระเงิน
                        </div>
                    `;
                } else {
                    const pendingList = document.createElement('div');
                    pendingList.className = 'list-group';
                    
                    pendingSnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'list-group-item';
                        
                        const tableLabel = data.tableLabel || getTableLabel(data.tableNumber);
                        const bookedDate = data.bookedAt ? 
                            data.bookedAt.toDate().toLocaleDateString('th-TH', {
                                day: 'numeric',
                                month: 'short',
                                year: 'numeric'
                            }) : 'ไม่ทราบวันที่';
                        
                        item.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">โต๊ะ ${tableLabel}</h6>
                                    <p class="mb-1">${data.userName || 'ไม่ทราบชื่อ'} (${data.userPhone || 'ไม่ทราบเบอร์'})</p>
                                    <small class="text-muted">จองเมื่อ: ${bookedDate}</small>
                                </div>
                                <div class="text-end">
                                    <div class="text-warning fw-bold">${(data.price || tablePrice).toLocaleString()} บาท</div>
                                    ${editMode ? `
                                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="editBooking('${doc.id}')">
                                        <i class="bi bi-pencil"></i> แก้ไข
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                        pendingList.appendChild(item);
                    });
                    
                    pendingDiv.appendChild(pendingList);
                }
                
                // รายการจองแล้ว
                const bookedDiv = document.getElementById('confirmedBookings');
                bookedDiv.innerHTML = '';
                
                if (bookedSnapshot.empty) {
                    bookedDiv.innerHTML = `
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle"></i> ไม่มีรายการจองที่อนุมัติแล้ว
                        </div>
                    `;
                } else {
                    const bookedList = document.createElement('div');
                    bookedList.className = 'list-group';
                    
                    bookedSnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'list-group-item';
                        
                        const tableLabel = data.tableLabel || getTableLabel(data.tableNumber);
                        const bookedDate = data.bookedAt ? 
                            data.bookedAt.toDate().toLocaleDateString('th-TH', {
                                day: 'numeric',
                                month: 'short',
                                year: 'numeric'
                            }) : 'ไม่ทราบวันที่';
                        
                        item.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">โต๊ะ ${tableLabel}</h6>
                                    <p class="mb-1">${data.userName || 'ไม่ทราบชื่อ'} (${data.userPhone || 'ไม่ทราบเบอร์'})</p>
                                    <small class="text-muted">จองเมื่อ: ${bookedDate}</small>
                                </div>
                                <div class="text-end">
                                    <div class="text-success fw-bold">${(data.price || tablePrice).toLocaleString()} บาท</div>
                                    ${editMode ? `
                                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="editBooking('${doc.id}')">
                                        <i class="bi bi-pencil"></i> แก้ไข
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                        bookedList.appendChild(item);
                    });
                    
                    bookedDiv.appendChild(bookedList);
                }
            } catch (error) {
                console.error('Error loading bookings by status:', error);
                document.getElementById('pendingBookings').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> เกิดข้อผิดพลาดในการโหลดข้อมูล
                    </div>
                `;
                document.getElementById('confirmedBookings').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> เกิดข้อผิดพลาดในการโหลดข้อมูล
                    </div>
                `;
            }
        }

        // เปิด/ปิดโหมดแก้ไข
        function toggleEditMode() {
            if (!editMode) {
                // เปิดโหมดแก้ไข - แสดง modal ยืนยันรหัสผ่าน
                const modal = new bootstrap.Modal(document.getElementById('passwordModal'));
                modal.show();
            } else {
                // ปิดโหมดแก้ไข
                editMode = false;
                document.getElementById('editModeBtn').className = 'btn btn-warning edit-btn no-print';
                document.getElementById('editModeBtn').innerHTML = '<i class="bi bi-pencil-square"></i> โหมดแก้ไข';
                loadAllData();
            }
        }

        // ตรวจสอบรหัสผ่าน
        function verifyPassword() {
            const password = document.getElementById('adminPassword').value;
            const errorElement = document.getElementById('passwordError');
            
            if (password === ADMIN_PASSWORD) {
                editMode = true;
                document.getElementById('editModeBtn').className = 'btn btn-danger edit-btn no-print';
                document.getElementById('editModeBtn').innerHTML = '<i class="bi bi-x-circle"></i> ปิดโหมดแก้ไข';
                
                // ปิด modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('passwordModal'));
                modal.hide();
                
                // โหลดข้อมูลใหม่เพื่อแสดงปุ่มแก้ไข
                loadAllData();
                
                // ล้างรหัสผ่าน
                document.getElementById('adminPassword').value = '';
                errorElement.classList.add('d-none');
            } else {
                errorElement.classList.remove('d-none');
            }
        }

        // แก้ไขข้อมูลการจอง
        async function editBooking(bookingId) {
            try {
                const doc = await db.collection('tables').doc(bookingId).get();
                if (!doc.exists) {
                    alert('ไม่พบข้อมูลการจองนี้');
                    return;
                }
                
                const data = doc.data();
                const bookedDate = data.bookedAt ? 
                    data.bookedAt.toDate().toLocaleDateString('th-TH', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : 'ไม่ทราบวันที่';
                
                // เตรียมข้อมูลใน modal
                document.getElementById('editBookingId').value = bookingId;
                document.getElementById('editTableNumber').value = data.tableLabel || getTableLabel(data.tableNumber);
                document.getElementById('editUserName').value = data.userName || '';
                document.getElementById('editUserPhone').value = data.userPhone || '';
                document.getElementById('editStatus').value = data.status || 'pending';
                document.getElementById('editPrice').value = data.price || tablePrice;
                
                // ตั้งชื่อ modal
                document.getElementById('editModalTitle').textContent = `แก้ไขข้อมูลการจอง (${bookedDate})`;
                
                // แสดง modal
                const modal = new bootstrap.Modal(document.getElementById('editModal'));
                modal.show();
                
            } catch (error) {
                console.error('Error loading booking data:', error);
                alert('เกิดข้อผิดพลาดในการโหลดข้อมูลการจอง');
            }
        }

        // บันทึกการเปลี่ยนแปลง
        async function saveChanges() {
            const bookingId = document.getElementById('editBookingId').value;
            const userName = document.getElementById('editUserName').value;
            const userPhone = document.getElementById('editUserPhone').value;
            const status = document.getElementById('editStatus').value;
            const price = parseInt(document.getElementById('editPrice').value);
            
            if (!userName || !userPhone || !status || isNaN(price)) {
                alert('กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง');
                return;
            }
            
            try {
                await db.collection('tables').doc(bookingId).update({
                    userName: userName,
                    userPhone: userPhone,
                    status: status,
                    price: price
                });
                
                alert('บันทึกการเปลี่ยนแปลงเรียบร้อยแล้ว');
                
                // ปิด modal และโหลดข้อมูลใหม่
                const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                modal.hide();
                
                loadAllData();
            } catch (error) {
                console.error('Error updating booking:', error);
                alert('เกิดข้อผิดพลาดในการบันทึกข้อมูล');
            }
        }

        // ลบข้อมูลการจอง
        async function deleteBooking() {
            if (!confirm('แน่ใจว่าต้องการลบข้อมูลการจองนี้หรือไม่?\nการกระทำนี้ไม่สามารถยกเลิกได้')) {
                return;
            }
            
            const bookingId = document.getElementById('editBookingId').value;
            
            try {
                await db.collection('tables').doc(bookingId).delete();
                
                alert('ลบข้อมูลการจองเรียบร้อยแล้ว');
                
                // ปิด modal และโหลดข้อมูลใหม่
                const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                modal.hide();
                
                loadAllData();
            } catch (error) {
                console.error('Error deleting booking:', error);
                alert('เกิดข้อผิดพลาดในการลบข้อมูล');
            }
        }

        // ฟังก์ชันช่วยเหลือ: แปลงหมายเลขโต๊ะเป็นรูปแบบ A1-N8
        function getTableLabel(tableNumber) {
            const row = Math.ceil(tableNumber / 8);
            const col = ((tableNumber - 1) % 8) + 1;
            const rowLetter = String.fromCharCode(64 + row);
            return `${rowLetter}${col}`;
        }
    </script>
</body>
</html>
